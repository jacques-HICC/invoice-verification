<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <header>
        <h1>üßæ AI-Assisted Invoice Validation</h1>
    </header>
    
    <div class="top-stats">
        <div>
            <div>Total Invoices</div>
            <div id="total-invoices">0</div>
        </div>
        <div>
            <div>Processed by AI</div>
            <div id="ai-processed">0</div>
        </div>
        <div>
            <div>Verified</div>
            <div id="verified">0</div>
        </div>
        <button onclick="startSync()" title="Click to add any new invoices from GCDocs to the SharePoint tracker">
            Scan for new invoices
        </button>
    </div>

    <main id="main-content">
        <section class="ai-processing-section">
            <div class="processing-card">
                <div class="processing-info">
                    <h3>üìã Unprocessed Invoices</h3>
                    <div class="unprocessed-count" id="unprocessed-count">0</div>
                    <p class="help-text">Invoices waiting for AI extraction</p>
                    <div class="model-selector">
                        <label for="model-select">Model:</label>
                        <select id="model-select">
                            <option value="">Loading models...</option>
                        </select>
                    </div>
                </div>
                <button class="process-btn" onclick="openProcessDialog()" id="process-btn">
                    ü§ñ Process with AI
                </button>
            </div>
        </section>

        <section class="validation-section">
            <div class="invoice-preview">
                <div class="preview-header">
                    <div class="page-navigation" id="page-navigation" style="display: none;">
                        <button id="prev-page-btn" onclick="previousPage()">‚óÄ Previous</button>
                        <span class="page-info">
                            Page <span id="current-page">1</span> of <span id="total-pages">1</span>
                        </span>
                        <button id="next-page-btn" onclick="nextPage()">Next ‚ñ∂</button>
                    </div>
                    <h2>Invoice Preview</h2>
                    <div class="preview-actions">
                        <button class="refresh-btn" onclick="openInGCDocs()" id="gcdocs-btn" style="display: none;">
                            üîó Display Full Invoice
                        </button>
                        <button class="refresh-btn" onclick="refreshInvoice()" id="refresh-btn">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
                <div class="zoom-controls">
                    <button onclick="zoomIn()" title="Zoom In">+</button>
                    <div class="zoom-level" id="zoom-level">100%</div>
                    <button onclick="zoomOut()" title="Zoom Out">‚àí</button>
                    <button onclick="resetZoom()" title="Reset Zoom">‚ü≤</button>
                    <button onclick="fitToWidth()" title="Fit Width">‚¨å</button>
                </div>

                <div id="invoice-display">
                    <div class="loading-preview">
                        Loading invoice...
                    </div>
                </div>
            </div>

            <div class="fields-panel">
                <h2>
                    Extracted Information
                    <span id="confidence-badge" class="confidence-badge"></span>
                </h2>
                <form id="validation-form">
                    <input type="hidden" id="node-id" name="node_id">
                    
                    <label>Vendor/Company Name</label>
                    <input type="text" id="company-name" name="company_name">

                    <label>Invoice Number</label>
                    <input type="text" id="invoice-number" name="invoice_number">

                    <label>Invoice Date</label>
                    <input type="date" id="invoice-date" name="invoice_date">

                    <label>Total Amount</label>
                    <input type="number" step="0.01" id="total-amount" name="total_amount">

                    <label>Notes</label>
                    <textarea id="notes" name="notes" rows="3"></textarea>

                    <div class="action-buttons">
                        <button type="button" onclick="saveAndNext()" id="save-next-btn">üíæ Save & Next ‚û°Ô∏è</button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <div id="sync-output-container">
        <div class="console-header" onclick="toggleConsole()">
            <div class="resize-handle" onclick="event.stopPropagation()"></div>
            <span>Console</span>
            <span id="console-toggle">‚ñ≤</span>
        </div>
        <div id="sync-output"></div>
    </div>

    <div id="process-modal" class="modal">
        <div class="modal-content">
            <h2>ü§ñ Process Invoices with AI</h2>
            <p>Select how many invoices to process:</p>
            
            <div class="range-display" id="process-count-display">10</div>
            
            <div class="input-group">
                <input 
                    type="range" 
                    id="process-count-slider" 
                    min="1" 
                    max="100" 
                    value="10"
                    oninput="updateProcessCount(this.value)"
                >
            </div>

            <div class="input-group">
                <label>Or enter a specific number:</label>
                <input 
                    type="number" 
                    id="process-count-input" 
                    min="1" 
                    value="10"
                    onchange="updateProcessCount(this.value)"
                >
            </div>

            <div class="quick-actions">
                <button class="quick-btn" onclick="setProcessCount(10)">10 invoices</button>
                <button class="quick-btn" onclick="setProcessCount(50)">50 invoices</button>
                <button class="quick-btn" onclick="setProcessCount('all')">Process All</button>
            </div>

            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeProcessDialog()">Cancel</button>
                <button class="btn-primary" onclick="startProcessing()">Start Processing</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>